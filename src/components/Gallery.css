/* Gallery.css */
@import url('https://fonts.googleapis.com/css2?family=Saira:wght@400;700&family=Caveat:wght@400;700&family=Ubuntu:wght@400;700&family=Ubuntu+Mono:wght@400;700&display=swap');

@property --k {
	syntax: '<number>';
	initial-value: -1;
	inherits: true;
}

@property --ang {
	syntax: '<angle>';
	initial-value: 0deg;
	inherits: false;
}

* { 
	margin: 0; 
}

.gallery-container {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100vh;
	display: grid;
	grid-template-rows: max-content 1fr max-content;
	z-index: 1000;
}

.gallery-header,
.scene,
.assembly,
.assembly article,
.assembly figure {
	display: grid;
}



@keyframes k {
	to {
		--k: 1;
	}
}

svg[height='0'][aria-hidden='true'] {
	position: fixed;
}

.gallery-header {
	place-content: center;
	place-items: center;
	padding: 0.5em;
	text-align: center;
	text-wrap: balance;
}

.gallery-header em {
	max-width: 32em;
}

.scene {
	overflow: hidden;
	perspective: 50em;
}

.assembly,
.assembly article {
	transform-style: preserve-3d;
}

.assembly {
	--r: calc(2 + var(--dir)) / 3;
	--w: clamp(4em, min(50vh, 25vw), 18em);
	--z: calc(var(--f, 1.25) * -0.5 * var(--w) / tan(0.5turn / var(--n)));
	place-self: center;
	translate: 0 0 var(--z);
	rotate: var(--dir) calc(1 - var(--dir)) 0 calc((var(--k) + 0.5) * -1turn);
}

.assembly article,
.assembly article header,
.assembly figure,
.assembly img,
.assembly figcaption {
	grid-area: 1 / 1;
}

.assembly article {
	/* item progress value */
	--j: var(--i) / var(--n);
	/* linear difference between this item's progress value  
	 * and progress value of highlighted item in front - 
	 * it's a value in the [0, 1] interval */
	--dif-lin: calc(var(--j) - mod(var(--k) + 1, 1));
	/* absolute value of linear difference */
	--abs-lin: abs(var(--dif-lin));
	/* difference between middle & absolute linear difference */
	--dif-mid: calc(0.5 - var(--abs-lin));
	--abs-mid: abs(var(--dif-mid));
	/* relative distance to from this item 
	 * to highlighted one in front */
	--dif-arc: calc(2 * (0.5 - var(--abs-mid)));
	/* relative distance limit */
	--lim: 0.35;
	--sel: max(0, calc((var(--lim) - var(--dif-arc)) / var(--lim)));
	--out: calc(1 - var(--sel));
	--hov: 0;
	width: var(--w);
	aspect-ratio: var(--r);
	transform: rotate3d(var(--dir), calc(1 - var(--dir)), 0, calc(var(--j) * 1turn))
		translatez(var(--z)) rotate(calc(var(--dir) * 0.5turn));
}

.assembly article header {
	rotate: y calc((1 + var(--hov)) * 0.5turn);
}

.assembly article:hover,
.assembly article:focus-within {
	--hov: round(var(--sel));
}

/* Fallback for browsers that don't support abs() */
@supports not (scale: abs(-1)) {
	.assembly article {
		--abs-lin: max(var(--dif-lin), calc(-1 * var(--dif-lin)));
		--abs-mid: max(var(--dif-mid), calc(-1 * var(--dif-mid)));
	}
}

.assembly article header,
.assembly figure {
	--ang: calc(-45deg + var(--hov) * 180deg);
	overflow: hidden;
	position: relative;
	border: solid 4px transparent;
	border-radius: 0.5em;
	backface-visibility: hidden;
	box-shadow: 5px 5px 13px #000;
	background: var(--url) 50% / cover padding-box, linear-gradient(#666 0 0) padding-box,
		repeating-conic-gradient(
			from var(--ang),
			transparent 0% 15%,
			color-mix(in srgb, #f48c06 calc(var(--sel) * 100%), #333) 20% 30%,
			transparent 35% 50%
		)
		border-box #121212;
	background-blend-mode: multiply, normal, normal;
	isolation: isolate;
	/* prevent edge glitching on article hover */
	pointer-events: none;
	transition: 0.35s ease-out;
	transition-property: rotate, --ang;
}

.assembly article header::after,
.assembly figure::after {
	position: absolute;
	inset: 0;
	opacity: var(--out);
	background: #03071e;
	mix-blend-mode: color;
	pointer-events: none;
	content: '';
}

/* reverse from parent */
.assembly h2,
.assembly em,
.assembly img,
.assembly a {
	pointer-events: auto;
}

.assembly h2,
.assembly em,
.assembly figcaption {
	opacity: round(up, var(--sel));
	text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.4);
}

.assembly h2 {
	font-size: 1.125em;
}

.assembly figure {
	rotate: y calc(var(--hov) * 0.5turn);
}

.assembly img {
	width: 100%;
	height: 100%;
	aspect-ratio: var(--r);
	object-fit: cover;
	object-position: var(--pos);
}

.assembly figcaption {
	align-self: end;
	padding: 0.5em;
	background: rgba(255, 255, 255, 0.2);
	color: #040404;
	font: max(0.75rem, 0.75em) 'Caveat', cursive;
	text-align: right;
	backdrop-filter: blur(5px) brightness(1.5);
}

.assembly figcaption a {
	color: #370617;
}

/* just support info boxes if it lacks support */
aside {
	position: fixed;
	bottom: 0;
	padding: 0.5em;
}

.box-info-scrollani {
	margin: 0.5em;
	border-left: solid 5px #dc3055;
	padding: 0.75em;
	box-shadow: 2px 2px 5px hsla(0, 0%, 0%, 0.35);
	background: #851d40;
	color: #fff;
	font: 1em / 1.25 'Ubuntu', 'Trebuchet MS', Arial, sans-serif;
}

@supports (animation-timeline: scroll()) {
	.box-info-scrollani {
		display: none;
	}
}

kbd {
	padding: 2px;
	background: hsla(0, 0%, 0%, 0.35);
	font: 1.1em / 1.2 'Ubuntu Mono', 'Consolas', 'Monaco', monospace;
}